# Live Environment Troubleshooting Guide

## Issue: "Failed to create guide. Please try again" on Live Site

### The Problem
- Guide creation works perfectly on localhost
- Same operation fails on live/production environment
- User sees generic error message

### Most Likely Causes & Solutions

## 1. Authentication/Session Issues

**Problem**: Sessions not persisting in production environment.

**Solution**: Check session configuration in production:

```bash
# In your Render dashboard, verify these environment variables:
SESSION_SECRET=your-secure-random-string
NODE_ENV=production
```

**Test**: Visit your live site `/api/debug/admin` endpoint to check session status.

## 2. Environment Variables

**Problem**: Missing or incorrect environment variables on live server.

**Solution**: Verify in Render dashboard:
- `NODE_ENV=production`
- `SESSION_SECRET` (generated by Render)
- `DATABASE_URL` (if using database)
- All other required variables from `env.example`

## 3. CORS Issues

**Problem**: Cross-Origin Resource Sharing blocking requests.

**Symptoms**: 
- Browser console shows CORS errors
- Requests fail with network errors

**Solution**: The server already has CORS configured, but verify:
1. Your client's `VITE_API_URL` points to the correct server
2. No trailing slashes in URLs
3. Both sites use HTTPS in production

## 4. Database Connection Issues

**Problem**: Database not accessible or misconfigured.

**Symptoms**:
- Storage operations fail
- No guides load
- Internal server errors

**Solution**: 
1. Check database connection string
2. Ensure database is accessible from Render
3. Verify database permissions

## 5. Server Logs Analysis

**Check Render Logs**:
1. Go to Render dashboard
2. Select your web service
3. Click "Logs" tab
4. Look for errors when creating guides

Common error patterns:
- Database connection errors
- Session storage issues
- Authentication failures
- File size/memory limits

## Quick Debug Steps

### Step 1: Test Basic Connectivity
Visit these URLs in your browser (replace with your actual domain):
- `https://your-app.onrender.com/api/health` - Should return 200 OK
- `https://your-app.onrender.com/api/debug` - Shows environment info
- `https://your-app.onrender.com/api/debug/admin` - Shows session info

### Step 2: Check Browser Developer Tools
1. Open browser DevTools (F12)
2. Go to Network tab
3. Try creating a guide
4. Look for failed requests
5. Check Console tab for JavaScript errors

### Step 3: Compare Local vs Live
Run the same operation on both environments and compare:
- Network requests
- Response codes
- Response data
- Console errors

### Step 4: Test Authentication
1. Login to admin panel on live site
2. Check `/api/auth/me` endpoint
3. Verify session is established
4. Try guide creation immediately after login

## Common Production Issues

### Memory Store vs Database Store
- **Local**: Uses memory session store
- **Production**: Should use PostgreSQL session store
- **Fix**: Ensure `DATABASE_URL` is properly configured

### HTTPS vs HTTP
- **Local**: HTTP (localhost:5000)
- **Production**: HTTPS (required by Render)
- **Fix**: Ensure all URLs use HTTPS in production

### File Size Limits
- **Local**: Usually unlimited
- **Production**: May have memory/file size limits
- **Fix**: Check if file uploads are causing issues

## Immediate Action Plan

1. **Check Render Logs**: Look for actual error messages
2. **Verify Environment Variables**: Ensure all are set correctly
3. **Test Debug Endpoints**: Use the URLs above to check system status
4. **Browser DevTools**: Check for network/CORS errors
5. **Session Test**: Login and immediately try guide creation

## If Still Not Working

Add these temporary debug logs to your live server:

```javascript
// In server/routes.ts, add to guide creation endpoint
console.log("ðŸ”§ Guide creation attempt:", {
  timestamp: new Date().toISOString(),
  body: req.body,
  session: req.session,
  headers: {
    origin: req.headers.origin,
    userAgent: req.headers['user-agent']
  }
});
```

Then redeploy and check the Render logs when trying to create a guide.

## Contact Support

If none of these solutions work, provide:
1. Render logs showing the exact error
2. Browser DevTools network tab screenshots
3. Environment variables configuration (without sensitive values)
4. Steps to reproduce the issue
